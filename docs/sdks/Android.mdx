# Android

##### Latest Version: [![](https://jitpack.io/v/rettersoft/rbs-android-sdk.svg)](https://jitpack.io/#rettersoft/rbs-android-sdk)

##### Add it in your root build.gradle at the end of repositories:

```
allprojects {
  repositories {
  	...
  	maven { url 'https://jitpack.io' }
  }
}
```

##### Add the dependency

```
dependencies {
   implementation 'com.github.rettersoft:rbs-android-sdk:1.0.1'
}
```

##### Proguard config

```
-keep class com.rettermobile** { *; }
-keep class com.rettermobile.* { *; }
```


### How to use?

```typescript
val rbs = RBS(applicationContext = applicationContext, projectId = "{PROJECT_ID}")
```

```typescript
rbs.setOnClientAuthStatusChangeListener { rbsClientAuthStatus, rbsUser -> }
```

```typescript
rbs.sendAction(
  action = "rbs.businessuserauth.request.LOGIN",
  data = mapOf(Pair("email", "email@test.com"), Pair("password", "password")),
  success = {
     val type = object : TypeToken<List<AuthResponse>>() {}.type
     val items: List<AuthResponse> = Gson().fromJson(it!!, type)

     rbs.authenticateWithCustomToken(items[0].response!!.customToken)
  }
)
```

```typescript
rbs.sendAction(action = "rbs.product.request.SEARCH", success = { jsonData ->
  Log.e("RBSService", jsonData) // Convert to data model with Gson()
  Toast.makeText(this, jsonData, Toast.LENGTH_LONG).show()
}, error = {
  Toast.makeText(this, it?.message, Toast.LENGTH_LONG).show()
})
```

```typescript
rbs.signOut()
```

### Cloud Objects

Get a cloud object and subscribe to its state

```typescript
rbs.getCloudObject(
   options = RBSCloudObjectOptions(
         classId = "AndroidTest",
         instanceId = "01FPTD2HAQGB5BS7J01S0QD7Q2"
   ),
   success = { cloudObj ->
         this@MainActivity.cloudObj = cloudObj

         cloudObj?.user?.subscribe(eventFired = {
            RBSLogger.log("SUCCESS USER $it")
         }, errorFired = {
            RBSLogger.log("SUCCESS USER ${it?.message}")
         })

         cloudObj?.role?.subscribe(eventFired = {
            RBSLogger.log("SUCCESS ROLE $it")
         }, errorFired = {
            RBSLogger.log("SUCCESS ROLE ${it?.message}")
         })

         cloudObj?.public?.subscribe(eventFired = {
            RBSLogger.log("SUCCESS PUBLIC $it")
         }, errorFired = {
            RBSLogger.log("SUCCESS PUBLIC ${it?.message}")
         })
   })
```

Call a method on an object instance

```typescript
cloudObj?.call(
      options = RBSCloudObjectOptions(method = "sayHello"),
      eventFired = {
         val response = Gson().fromJson(it, SomeModel::class.java)
      })
```