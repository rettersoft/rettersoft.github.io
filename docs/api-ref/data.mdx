---
sidebar_position: 6
---

# Data Object

Every step handler is handed a data object like below:

```typescript
export async function sayHello(data: Data): Promise<StepResponse> {
    return data
}
```

Step handler can make some changes to data object and return it.

***

## data

Data object has following interface:

```typescript
export interface Data extends StepResponse {
    context: Context
    env: KeyValue
    config: Configuration
    version: number
    state: State
    method: Method
    schedule: Schedule[]
}
```

__`context: Context`__

Context contains information about class and first execution of this instance.

__`env: KeyValue`__

Environment variables passed to this class method execution.

__`config: Configuration`__

Docs coming soon.

__`version: number`__

Docs coming soon.

__`state: State`__

State of this instance. It is used to get latest state and also update it by manipulating and returning it.

__`method: Method`__

Used to read information about this methods context and also read request data like body, statusCode and headers. This field is also used to return a response to the caller.

__`schedule: Schedule[]`__

Used to schedule a new method call after a delay. 

For more info see: [Scheduling](/docs/main_concepts/method_scheduling/)

***

## data.context

This object is filled with information when this instance was created.

```typescript
export interface Context {
    requestId: string
    projectId: string 
    action: string 
    identity: string 
    serviceId?: string
    headers?: KeyValue 
    classId: string 
    instanceId?: string 
    methodName: string
    refererClassId?: string
    refererInstanceId?: string
    refererMethodName?: string
    refererUserId?: string
    refererIdentity?: string
    claims?: KeyValue
    isAnonymous?: boolean
    culture?: string
    platform?: string
    userId?: string
    sourceIP: string
    sessionId?: string
    clientOs?: string
    targetServiceIds?: string[]
    relatedUserId?: string
}
```

__`requestId: string`__

Request id of the INIT call.

__`projectId: string`__

ProjectId of this request.

__`action: string`__

Action is a special string used internally by retter. data.context object always has "rbs.core.request.INSTANCE" as its action.

__`identity: string`__

Role of the user who created this instance.

__`headers?: KeyValue`__ 

Headers used to initialize this instance.

__`classId: string`__ 

ClassId of this instance.

__`instanceId?: string`__ 

Unique id of this instance.

__`methodName: string`__

This methodName is always "INIT" in data.context. 

__`claims?: KeyValue`__

Data included in the JWT token used when creating this instance.

__`isAnonymous?: boolean`__

Was the creator of the instance anonymous? If so: true.

__`userId?: string`__

User id of the creator of this instance.

__`sourceIP: string`__

IP address of the creator of this instance.

__`clientOs?: string`__

Client operating system of the creator of this instance.

***

## data.method

Method object is used to read incoming request and write data to returning response. It's interface is like below:

```typescript
interface Method {
    name: string
    context: Context
    state: KeyValue
    request?: Request
    response?: Response
}
```

__`name: string`__

Name of the method.

__`context: string`__

Context contains information like identities, ip addresses for this request.

__`state: string`__

Method state is a temporary storage which is passed from step to step. It is not stored after the method returns. You can use it to pass data between your steps but don't want to store that state in persistent state.

__`request: string`__

Request object contains data sent to this method.

__`response: string`__ 

You use response object to write data to the response of this method. Example usage:

```typescript
data.method.response = {
    statusCode: 200,
    headers: {
        "content-type": "application/json"
    },
    body: {
        message: "OK"
    }
}
```

***

## data.method.context

Method context is filled at every method request with following information.

```typescript
export interface Context {
    requestId: string
    projectId: string 
    action: string 
    identity: string 
    serviceId?: string
    headers?: KeyValue 
    classId: string 
    instanceId?: string 
    methodName: string
    refererClassId?: string
    refererInstanceId?: string
    refererMethodName?: string
    refererUserId?: string
    refererIdentity?: string
    claims?: KeyValue
    isAnonymous?: boolean
    culture?: string
    platform?: string
    userId?: string
    sourceIP: string
    sessionId?: string
    clientOs?: string
    targetServiceIds?: string[]
    relatedUserId?: string
}
```

__`requestId: string`__

Request id of method call.

__`projectId: string`__

ProjectId of this request.

__`action: string`__

Action is a special string used internally by retter. data.method.context object always has "rbs.core.request.CALL" as its action.

__`identity: string`__

Role of the user who is making this call.

__`classId: string`__ 

ClassId of this instance.

__`instanceId?: string`__ 

Unique id of this instance.

__`methodName: string`__

Name of this method.

__`claims?: KeyValue`__

Data included in the JWT token used when creating this instance.

__`isAnonymous?: boolean`__

Is the caller of this method anonymous?

__`userId?: string`__

User id of the caller.

__`sourceIP: string`__

IP address of the caller.

__`clientOs?: string`__

Client operating system of caller.

***

## data.method.request

Request object contains incoming data in this method call.

```typescript
export interface Request {
    httpMethod: string
    body?: any
    headers: { [key: string]: string }
    queryStringParams: { [key: string]: string }
}
```

__`httpMethod: string`__

Http method of the call like: GET, POST, PUT etc.

__`body: string`__

Post body of http request.

__`headers: string`__

Headers sent from the client.

__`queryStringParams: string`__

Query strings sent in this request.


***

## data.method.response

Response object can be used to return a response to the caller.

```typescript
export interface CloudObjectResponse {
    statusCode: number
    body?: any
    headers?: { [key: string]: string }
}
```

__`statusCode: string`__

Returning statusCode.

__`body: string`__

Response body of this method.

__`headers: string`__

Headers sent to the client.

### Example usage:

```typescript
export async function sayHello(data: Data): Promise<StepResponse> {
    data.method.response = {
        statusCode: 200,
        headers: {
            "content-type": "application/json"
        },
        body: {
            message: "Hello"
        }
    }
    return data
}
```
