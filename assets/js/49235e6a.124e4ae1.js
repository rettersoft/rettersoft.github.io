"use strict";(self.webpackChunkrio_doc=self.webpackChunkrio_doc||[]).push([[1860],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=r.createContext({}),l=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(n),h=a,m=p["".concat(u,".").concat(h)]||p[h]||d[h]||i;return n?r.createElement(m,o(o({ref:t},c),{},{components:n})):r.createElement(m,o({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=p;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},6350:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return u},default:function(){return h},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return d}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],s={sidebar_label:"Authentication/Authorization",sidebar_position:8},u="Authorization",l={unversionedId:"Concepts/Authentication_Authorization",id:"Concepts/Authentication_Authorization",title:"Authorization",description:"Every incoming request has a context. This context contains some information and it's interface is like below:",source:"@site/docs/Concepts/Authentication_Authorization.md",sourceDirName:"Concepts",slug:"/Concepts/Authentication_Authorization",permalink:"/docs/Concepts/Authentication_Authorization",editUrl:"https://github.com/rettersoft/rettersoft.github.io/blob/master/docs/Concepts/Authentication_Authorization.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_label:"Authentication/Authorization",sidebar_position:8},sidebar:"ConceptsSideBar",previous:{title:"Methods",permalink:"/docs/Concepts/Methods"},next:{title:"Sorted Sets",permalink:"/docs/Concepts/Sorted Sets"}},c={},d=[{value:"Authentication",id:"authentication",level:2},{value:"Users or services",id:"users-or-services",level:3},{value:"Authorization",id:"authorization-1",level:2},{value:"preAuthorizer",id:"preauthorizer",level:3},{value:"authorizer",id:"authorizer",level:3}],p={toc:d};function h(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"authorization"},"Authorization"),(0,i.kt)("p",null,"Every incoming request has a context. This context contains some information and it's interface is like below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export interface Context {\n    requestId: string\n    projectId: string\n    action: string\n    identity: string\n    serviceId?: string\n    payload?: KeyValue\n    headers?: KeyValue\n    classId: string\n    instanceId?: string\n    methodName: string\n    refererClassId?: string\n    refererInstanceId?: string\n    refererMethodName?: string\n    refererUserId?: string\n    refererServiceId?: string\n    refererIdentity?: string\n    claims?: KeyValue\n    isAnonymous?: boolean\n    culture?: string\n    platform?: string\n    userId?: string\n    sourceIP: string\n    sessionId?: string\n    clientOs?: string\n    targetServiceIds?: string[]\n    relatedUserId?: string\n}\n")),(0,i.kt)("p",null,"This context object is delivered to your code like below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export async function sayHello(data: Data): Promise<StepResponse> {\n    console.log(data.context)\n    return data\n}\n")),(0,i.kt)("p",null,"For authorization we can use several of these fields:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"identity"),": Name of the role used to make this request."),(0,i.kt)("li",{parentName:"ul"},"claims: Token claims."),(0,i.kt)("li",{parentName:"ul"},"serviceId"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"userId"),": Users ID making this request. Can be null if this request is coming from a service or anonymous rest call."),(0,i.kt)("li",{parentName:"ul"},"sourceIP: IP adress this request is coming from."),(0,i.kt)("li",{parentName:"ul"},"isAnonymous: A boolean field indicating if the caller is a anonymous user. ")),(0,i.kt)("h2",{id:"authentication"},"Authentication"),(0,i.kt)("p",null,"Your classes are public on the internet. Anybody can call their methods. There are several methods to prevent unauthorized access. Let's first talk about users and services."),(0,i.kt)("h3",{id:"users-or-services"},"Users or services"),(0,i.kt)("p",null,"A caller can be either a user or a service. If you use the rest api and send requests without any access token, your context.identity will be rbs_anonymous_service. Other than this scenario there always must be a token in the request. Token management is usually done by sdk's."),(0,i.kt)("p",null,'By default any request sent to server side is made with anonymous users. An anonymous user is created on the fly and request is made. If so, isAnonymous field will be "true" in the context.'),(0,i.kt)("h2",{id:"authorization-1"},"Authorization"),(0,i.kt)("p",null,"Now that we know that there will be a identity in the context object let's talk about how to use it."),(0,i.kt)("p",null,"We know that cloud object methods are called in a fifo manner."),(0,i.kt)("p",null,"Let's say we have a wallet class holding a single amount value in its state.\n//IMAGE"),(0,i.kt)("p",null,"We might have methods on this class:\n//IMAGE"),(0,i.kt)("p",null,"Everytime these are called they are ordered:\n//IMAGE"),(0,i.kt)("p",null,"You can define two authorization methods in your template:\n//IMAGE"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"preAuthorizer: index.preAuthorizer\nauthorizer: index.authorizer\n")),(0,i.kt)("h3",{id:"preauthorizer"},"preAuthorizer"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"preAuthorizer is called before messages are ordered."),(0,i.kt)("li",{parentName:"ul"},"preAuthorizer is called without state data. You can only use identity related information for authorization here.")),(0,i.kt)("p",null,"An example preauthorizer checking called method and caller identity name:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'export async function preAuthorizer(data: Data): Promise<Response> {\n    if(data.content.methodName === "sayHello" && data.context.identity === "rbs_anonymous_user") return { statusCode: 403 }\n    return { statusCode: 200 }\n}\n')),(0,i.kt)("h3",{id:"authorizer"},"authorizer"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"authorizer is called in the queue. So each call to this function is ordered. You can check your state safely and make decisions."),(0,i.kt)("li",{parentName:"ul"},"authorizer is called with the state data.")),(0,i.kt)("p",null,"Below there is an authorizer checking the state if this method can be called by this user:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'export async function authorizer(data: Data): Promise<Response> {\n    if(data.context.methodName === "playHand" && \n        data.state.private.currentPlayerId !== data.context.userId) \n        return { statusCode: 403 }\n    return { statusCode: 200 }\n}\n')))}h.isMDXComponent=!0}}]);